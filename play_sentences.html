<script>
  // Map logical IDs to audio file paths (WAV recommended)
  const audioMap = {
    hp56: { silence: "audio/HP56.wav",  snr10: "audio/HP56_snr10.wav" },
    lp56: { silence: "audio/LP56.wav",  snr10: "audio/LP56_snr10.wav" },
    f56b: { silence: "audio/F56b.wav",  snr10: "audio/F56b_snr10.wav" }
  };

  let currentAudio = null;
  let currentBtn = null;

  function stopCurrent() {
    if (currentAudio) { currentAudio.pause(); currentAudio.currentTime = 0; }
    if (currentBtn) { currentBtn.classList.remove("playing"); currentBtn.classList.remove("noise"); }
    currentAudio = null;
    currentBtn = null;
  }

  document.getElementById('grid').addEventListener('click', (e) => {
    const btn = e.target.closest('button.card');
    if (!btn) return;

    const id = btn.getAttribute('data-id');
    const variant = btn.getAttribute('data-variant');

    // Accept both "ruhe" (from HTML) and "silence" (from audioMap)
    const key = (variant === 'ruhe') ? 'silence' : variant;

    const src = audioMap[id]?.[key];
    if (!src) {
      console.warn('No audio src for', { id, variant, resolvedKey: key });
      return;
    }

    if (currentBtn === btn) { // toggle off if same button
      stopCurrent();
      return;
    }

    stopCurrent();
    const a = new Audio(src);
    a.addEventListener('ended', stopCurrent);
    currentAudio = a;
    currentBtn = btn;
    btn.classList.add('playing');
    if (key === 'snr10') btn.classList.add('noise');

    a.play().catch(err => {
      console.error('Playback failed:', err);
    });
  });

  // Keyboard support: 1..3 -> Silence (top), 4..6 -> +10 dB (bottom)
  window.addEventListener('keydown', (ev) => {
    const k = ev.key;
    const map = {
      '1': ['hp56','ruhe'],   '2': ['lp56','ruhe'],   '3': ['f56b','ruhe'],
      '4': ['hp56','snr10'],  '5': ['lp56','snr10'],  '6': ['f56b','snr10']
    };
    if (!map[k]) return;
    const [id,variant] = map[k];
    const btn = document.querySelector(`button.card[data-id="${id}"][data-variant="${variant}"]`);
    if (btn) btn.click();
  });
</script>
